{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/article_list.css' %}">

<div class="container mt-4">

    <!-- ðŸ”â€¯AJAX Qidiruv input -->
    <div class="input-group mb-4">
        <input type="text"
               id="liveSearchInput"
               class="form-control"
               placeholder="ðŸ”â€¯Maqola, muallif, kategoriyaâ€¦">
        <span class="input-group-text bg-primary text-white">Qidirish</span>
    </div>

    <!-- ðŸ”Žâ€¯Natijalar shu yerga chiqadi -->
    <div id="search-results">
        {% include 'partials/search_results.html' %}
    </div>

</div>

<!-- ================= JS (AJAX Live Search) ================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const input     = document.getElementById('liveSearchInput');
    const container = document.getElementById('search-results');
    const ajaxUrl   = "{% url 'ajax_search' %}";   // Django reverseda xavfsiz

    // Kichik debounce â€‘ soâ€˜rovlarni haddan tashqari yubormaslik uchun
    let timer = null;

    input.addEventListener('keyup', () => {
        clearTimeout(timer);
        timer = setTimeout(() => liveSearch(input.value.trim()), 300);
    });

    function liveSearch(query) {
        // Boâ€˜sh qidiruvda sahifani qayta yuklamaymiz â€“ default roâ€˜yxat qoldiriladi
        if (query === "") return;

        fetch(`${ajaxUrl}?q=${encodeURIComponent(query)}`, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(res => res.text())
        .then(html => { container.innerHTML = html; })
        .catch(err => { console.error('Liveâ€¯search xatosi:', err); });
    }
});
</script>
{% endblock %}
